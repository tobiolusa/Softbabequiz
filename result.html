<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Softbabe Style Result</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            font-family: 'Montserrat', sans-serif;
            background: #ffffff;
            color: #333;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        header {
            background: #fff;
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 50px 20px; 
            text-align: center; 
            flex: 1 0 auto; 
            position: relative; 
            z-index: 2;
        }
        h1 { font-size: 2.5em; color: #000; }
        p { font-size: 1.2em; margin-bottom: 30px; color: #555; }
        .shop-btn, .retake-btn, .form-btn, .share-btn {
            padding: 15px 40px; font-size: 1.1em; background-color: #000; color: #fff;
            border: none; border-radius: 25px; cursor: pointer; margin: 10px;
        }
        .retake-btn { background-color: #ff6b6b; }
        .retake-btn:hover { background-color: #ff4d4d; }
        .shop-btn:hover, .form-btn:hover, .share-btn:hover { background-color: #333; }
        .results-section { animation: slideIn 0.8s ease-in; }
        footer { 
            background: #000; 
            color: #fff; 
            padding: 20px 0; 
            text-align: center; 
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .form-section {
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .form-container h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #000;
        }
        .form-container p {
            font-size: 1em;
            margin-bottom: 20px;
            color: #555;
        }
        .form-container input {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            font-family: 'Montserrat', sans-serif;
        }
        .form-container button {
            width: 100%;
            max-width: 400px;
        }
        .error-message {
            color: #ff4d4d;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .share-section {
            margin: 20px 0;
        }
        .share-btn {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #555;
            margin: 5px;
        }
        .share-btn.facebook { background-color: #3b5998; }
        .share-btn.twitter { background-color: #1da1f2; }
        .share-btn.instagram { background-color: #e4405f; }
        .share-btn.facebook:hover { background-color: #2f4377; }
        .share-btn.twitter:hover { background-color: #1886c9; }
        .share-btn.instagram:hover { background-color: #c13584; }
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: #fff;
            max-width: 500px;
            width: 90%;
            padding: 20px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease-in;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: #333;
        }
        .popup-content .form-container h2 {
            font-size: 1.8em;
            margin: 0 0 10px 0;
            color: #000;
        }
        .popup-content .form-container p {
            font-size: 1em;
            margin: 0 0 20px 0;
            color: #555;
        }
        .form-container input[type="checkbox"] {
            margin: 10px 0;
            width: auto;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="softbabe.jpeg" alt="Softbabe Logo" style="width: 80px;">
        </div>
        <a href="https://softbabelagos.com" target="_blank">
            <button class="shop-btn">Shop Now</button>
        </a>
    </header>

    <div class="container">
        <div id="results" class="results-section">
            <h1 id="result-title">Your Softbabe Style</h1>
            <img id="result-image" src="" alt="Your Style Image" style="max-width: 600px; height: 600px; display: none; margin: 20px auto;">
            <p id="result-description"></p>

            <button class="shop-btn" onclick="shopYourStyle()">Shop Your Style</button>
            <button class="retake-btn" onclick="retakeQuiz()">Retake Quiz</button>

            <div class="share-section">
                <button class="share-btn facebook" onclick="shareOnFacebook()">Share on Facebook</button>
                <button class="share-btn twitter" onclick="shareOnTwitter()">Share on Twitter</button>
                <button class="share-btn instagram" onclick="shareOnInstagram()">Share on Instagram</button>
            </div>
        </div>
    </div>

    <div id="popup-overlay" class="popup-overlay">
        <div class="popup-content">
            <span class="close-btn" onclick="closePopup()">×</span>
            <form id="popup-user-form">
                <div class="form-container">
                    <h2>Want your personalized Softbabe moodboard and discount code?</h2>
                    <p>Share your details to subscribe and get exclusive perks.</p>
                    <input type="text" id="popup-user-name" name="name" placeholder="Your Name" required>
                    <input type="email" id="popup-user-email" name="email" placeholder="Your Email" required>
                    <input type="checkbox" id="optin" name="_optin">
                    <label for="optin">I agree to join the Softbabe mailing list</label>
                    <button type="button" class="form-btn" onclick="storeUserData('popup')">Subscribe</button>
                    <p id="popup-error-message" class="error-message" style="display:none;">Please fill in both fields correctly and check the opt-in box</p>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="logo">
            <img src="newlogo.png" alt="Mini Logo" style="width: 50px;">
        </div>
        <div class="socials">
            <a href="https://instagram.com/softbabelagos" target="_blank">Instagram</a> |
            <a href="https://twitter.com/softbabelagos" target="_blank">Twitter</a> |
            <a href="https://facebook.com/softbabelagos" target="_blank">Facebook</a>
        </div>
        <div class="tagline">Being soft is a lifestyle.</div>
    </footer>

    <script>
        function storeUserData(formType = 'popup') {
            const nameInput = document.getElementById('popup-user-name').value.trim();
            const emailInput = document.getElementById('popup-user-email').value.trim();
            const optinCheckbox = document.getElementById('optin').checked;
            const errorMessage = document.getElementById('popup-error-message');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!nameInput || !emailRegex.test(emailInput) || !optinCheckbox) {
                errorMessage.style.display = 'block';
                return;
            }

            errorMessage.style.display = 'none';
            sessionStorage.setItem('userName', nameInput);
            sessionStorage.setItem('userEmail', emailInput);
            submitResult(true);
            closePopup();
        }

        function submitResult(includeUserDetails = false) {
            const userName = sessionStorage.getItem('userName') || '';
            const userEmail = sessionStorage.getItem('userEmail') || '';
            const quizAnswers = JSON.parse(sessionStorage.getItem('quizAnswers')) || {};
            const resultTitle = document.getElementById('result-title').innerText;

            if (!resultTitle || !Object.keys(quizAnswers).length) {
                console.error('Missing quiz data for submission');
                return;
            }

            // Extract the grouped style from the result title
            const style = resultTitle.split('You’re a ')[1]?.replace('!', '') || 'Luxe Babe';

            // Update localStorage with the grouped style count
            const resultCounts = JSON.parse(localStorage.getItem('resultCounts')) || {
                'Trendsetter Babe': 0,
                'Luxe Babe': 0,
                'Romantic Babe': 0,
                'Boss Babe': 0,
                'Statement Babe': 0
            };
            resultCounts[style] = (resultCounts[style] || 0) + 1;
            localStorage.setItem('resultCounts', JSON.stringify(resultCounts));

            const formData = new FormData();
            if (includeUserDetails && userName && userEmail) {
                formData.append('name', userName);
                formData.append('email', userEmail);
            }
            formData.append('finalResult', resultTitle);
            formData.append('answers', JSON.stringify(quizAnswers));

            fetch('https://formspree.io/f/xeoggvnd', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    console.log('Form submitted successfully:', data);
                    if (includeUserDetails) {
                        alert('Your details have been successfully submitted. Check your email for your moodboard and discount code!');
                    }
                } else {
                    console.warn('Submission response received but not successful:', data);
                    if (includeUserDetails) {
                        alert('There was a problem submitting your details. Please try again.');
                    }
                }
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                if (includeUserDetails) {
                    alert('There was an error submitting your details. Please check your network and try again.');
                }
            });
        }

        function shopYourStyle() {
            const resultTitle = document.getElementById('result-title').innerText;
            const style = resultTitle.split('You’re a ')[1]?.replace('!', '') || 'Luxe Babe';
            const styleUrls = {
                'Trendsetter Babe': 'https://softbabelagos.com/products/y2k-softbabe/2934657?location=206648',
                'Luxe Babe': 'https://softbabelagos.com/products/minimalist-softbabe/2934634?location=206648',
                'Romantic Babe': 'https://softbabelagos.com/products/romantic-softbabe/2934631?location=206648',
                'Boss Babe': 'https://softbabelagos.com/products/boss-babe-softbabe/2934648?location=206648',
                'Statement Babe': 'https://softbabelagos.com/products/afrocentric-softbabe/2934662?location=206648'
            };
            const url = styleUrls[style] || 'https://softbabelagos.com';
            window.open(url, '_blank');
        }

        function showResults() {
            const answers = JSON.parse(sessionStorage.getItem('quizAnswers')) || {};
            const userName = sessionStorage.getItem('userName') || 'User';

            // Map original styles to the five grouped styles
            const styleMapping = {
                'Statement Queen': 'Trendsetter Babe',
                'Edgy': 'Trendsetter Babe',
                'Y2K': 'Trendsetter Babe',
                'Minimalist': 'Luxe Babe',
                'Luxe': 'Luxe Babe',
                'Clean Girl': 'Luxe Babe',
                'That Girl': 'Luxe Babe',
                'Romantic': 'Romantic Babe',
                'Boss Babe': 'Boss Babe',
                'Bohemian': 'Statement Babe',
                'Afrocentric': 'Statement Babe',
                'Cultural': 'Statement Babe',
                'Sporty': 'Luxe Babe' // Fallback for unmapped styles
            };

            const styleCounts = {
                'Trendsetter Babe': 0,
                'Luxe Babe': 0,
                'Romantic Babe': 0,
                'Boss Babe': 0,
                'Statement Babe': 0
            };

            // Count only the mapped styles
            for (let i = 1; i <= 6; i++) {
                const styles = answers[`q${i}`];
                if (Array.isArray(styles)) {
                    styles.forEach(style => {
                        const mappedStyle = styleMapping[style] || 'Luxe Babe';
                        styleCounts[mappedStyle] = (styleCounts[mappedStyle] || 0) + 1;
                    });
                }
            }

            // Find the dominant style among the five grouped styles
            const dominantStyle = Object.keys(styleCounts).reduce((a, b) => styleCounts[a] > styleCounts[b] ? a : b, 'Luxe Babe');

            document.getElementById('result-title').innerText = `${userName}, You’re a ${dominantStyle}!`;

            const styleDescriptions = {
                'Trendsetter Babe': 'You’re bold and always ahead of the curve, embracing edgy, Y2K-inspired designs that make a statement.',
                'Luxe Babe': 'Your style is elegant and timeless, with a preference for sleek, minimalist, and sophisticated pieces.',
                'Romantic Babe': 'Soft and dreamy, you love delicate, feminine pieces with a touch of whimsy.',
                'Boss Babe': 'Confident and powerful, your style reflects strength and authority with a chic edge.',
                'Statement Babe': 'Vibrant and eclectic, you celebrate cultural and bohemian designs that tell a story.'
            };

            const resultDescription = document.getElementById('result-description');
            resultDescription.innerText = styleDescriptions[dominantStyle] || 'Your unique style shines through!';

            const resultImage = document.getElementById('result-image');
            const styleImages = {
                'Trendsetter Babe': 'result/y2k.jpeg',
                'Luxe Babe': 'result/minimalist.jpeg',
                'Romantic Babe': 'result/romantic.jpeg',
                'Boss Babe': 'result/bossbabe.jpeg',
                'Statement Babe': 'result/afrocentric.jpeg'
            };

            if (styleImages[dominantStyle]) {
                resultImage.src = styleImages[dominantStyle];
                resultImage.style.display = 'block';
            } else {
                resultImage.style.display = 'none';
            }

            submitResult(false);
        }

        function shareOnFacebook() {
            const resultTitle = document.getElementById('result-title').innerText;
            const style = resultTitle.split('You’re a ')[1]?.replace('!', '') || 'Softbabe';
            const text = encodeURIComponent(`I'm a ${style}! Discover your Softbabe Style at Softbabe Lagos!`);
            const url = encodeURIComponent('https://softbabelagos.com');
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        }

        function shareOnTwitter() {
            const resultTitle = document.getElementById('result-title').innerText;
            const style = resultTitle.split('You’re a ')[1]?.replace('!', '') || 'Softbabe';
            const text = encodeURIComponent(`I'm a ${style}! Find your Softbabe Style! #SoftbabeLagos`);
            const url = encodeURIComponent('https://softbabelagos.com');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        function shareOnInstagram() {
            const resultTitle = document.getElementById('result-title').innerText;
            const style = resultTitle.split('You’re a ')[1]?.replace('!', '') || 'Softbabe';
            alert(`To share your result on Instagram:\n1. Take a screenshot of this page.\n2. Post it to your Instagram feed or story with the caption:\n"I'm a ${style}! Discover your Softbabe Style at softbabelagos.com! #SoftbabeLagos"\n3. Tag @softbabelagos for a chance to be featured!`);
        }

        function retakeQuiz() {
            sessionStorage.removeItem('quizAnswers');
            sessionStorage.removeItem('userName');
            sessionStorage.removeItem('userEmail');
            window.location.href = 'form.html';
        }

        function showPopup() {
            document.getElementById('popup-overlay').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popup-overlay').style.display = 'none';
        }

        window.onload = function() {
            showResults();
            setTimeout(showPopup, 5000);
        };
    </script>
</body>
</html>